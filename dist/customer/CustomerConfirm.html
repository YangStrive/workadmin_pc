<!DOCTYPE html>
<html>
<head>
  <title>客户验证码确认-斗米工作助手</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0,user-scalable=no,minimal-ui">
  <link rel="stylesheet" type="text/css" href="confirm.css">
</head>

<body>
  <div id="app">
    <div class="customer_confirm">
      <div class="customer_bg">
        <div class="customer_blue">
        </div>
        <div class="customer_white">
        </div>
      </div>
      <div class="customer_mask">
        <div class="mask_main" style="width:'360px'">
          <div id="showmain1">
            <h2>请输入邮件中的验证码进行确认</h2>
            <i class="line"></i>
            <div class="num_ipt" style="width:314px">
              <input type="tel" class="code_input" maxlength="1"/>
              <input type="tel" class="code_input" maxlength="1"/>
              <input type="tel" class="code_input" maxlength="1"/>
              <input type="tel" class="code_input" maxlength="1"/>
            </div>
            <a href="javascript:;" id="confirmCode">确 认</a>
            <p class="error_msg" id="showerror" style="display: none;"></p>
          </div>
          <div class="success_main" id="showmain2" style="display: none;">
            <i class="success_ico"></i>
            <p class="success_info" id="success_info"></p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="el-message el-message1" style="z-index: 2001;display: none"><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjQwcHgiIGhlaWdodD0iNDBweCIgdmlld0JveD0iMCAwIDQwIDQwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPCEtLSBHZW5lcmF0b3I6IFNrZXRjaCAzOS4xICgzMTcyMCkgLSBodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2ggLS0+CiAgICA8dGl0bGU+aWNvbl93YXJuaW5nPC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGRlZnM+PC9kZWZzPgogICAgPGcgaWQ9IlBhZ2UtMSIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICAgICAgPGcgaWQ9Ik1lc3NhZ2UiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC02MC4wMDAwMDAsIC0yNzIuMDAwMDAwKSI+CiAgICAgICAgICAgIDxnIGlkPSLluKblgL7lkJFf5L+h5oGvLWNvcHkiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDYwLjAwMDAwMCwgMjcyLjAwMDAwMCkiPgogICAgICAgICAgICAgICAgPGcgaWQ9IlJlY3RhbmdsZS0yIj4KICAgICAgICAgICAgICAgICAgICA8ZyBpZD0iaWNvbl93YXJuaW5nIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHJlY3QgaWQ9IlJlY3RhbmdsZS0yIiBmaWxsPSIjRjdCQTJBIiB4PSIwIiB5PSIwIiB3aWR0aD0iNDAiIGhlaWdodD0iNDAiPjwvcmVjdD4KICAgICAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTIxLjYxNTM4NDYsMjYuNTQzMjA5OSBDMjEuNjE1Mzg0NiwyNi45NDc4NzUxIDIxLjQ1ODMzNDgsMjcuMjkxODM2OCAyMS4xNDQyMzA4LDI3LjU3NTEwMjkgQzIwLjgzMDEyNjgsMjcuODU4MzY4OSAyMC40NDg3MTk0LDI4IDIwLDI4IEMxOS41NTEyODA2LDI4IDE5LjE2OTg3MzIsMjcuODU4MzY4OSAxOC44NTU3NjkyLDI3LjU3NTEwMjkgQzE4LjU0MTY2NTIsMjcuMjkxODM2OCAxOC4zODQ2MTU0LDI2Ljk0Nzg3NTEgMTguMzg0NjE1NCwyNi41NDMyMDk5IEwxOC4zODQ2MTU0LDE5Ljc0NDg1NiBDMTguMzg0NjE1NCwxOS4zNDAxOTA3IDE4LjU0MTY2NTIsMTguOTk2MjI5IDE4Ljg1NTc2OTIsMTguNzEyOTYzIEMxOS4xNjk4NzMyLDE4LjQyOTY5NjkgMTkuNTUxMjgwNiwxOC4yODgwNjU4IDIwLDE4LjI4ODA2NTggQzIwLjQ0ODcxOTQsMTguMjg4MDY1OCAyMC44MzAxMjY4LDE4LjQyOTY5NjkgMjEuMTQ0MjMwOCwxOC43MTI5NjMgQzIxLjQ1ODMzNDgsMTguOTk2MjI5IDIxLjYxNTM4NDYsMTkuMzQwMTkwNyAyMS42MTUzODQ2LDE5Ljc0NDg1NiBMMjEuNjE1Mzg0NiwyNi41NDMyMDk5IFogTTIwLDE1LjgwNDI5ODEgQzE5LjQ0NDQ0MjcsMTUuODA0Mjk4MSAxOC45NzIyMjQsMTUuNjE5MzY4NyAxOC41ODMzMzMzLDE1LjI0OTUwNDYgQzE4LjE5NDQ0MjcsMTQuODc5NjQwNiAxOCwxNC40MzA1MjU1IDE4LDEzLjkwMjE0OTEgQzE4LDEzLjM3Mzc3MjYgMTguMTk0NDQyNywxMi45MjQ2NTc1IDE4LjU4MzMzMzMsMTIuNTU0NzkzNSBDMTguOTcyMjI0LDEyLjE4NDkyOTUgMTkuNDQ0NDQyNywxMiAyMCwxMiBDMjAuNTU1NTU3MywxMiAyMS4wMjc3NzYsMTIuMTg0OTI5NSAyMS40MTY2NjY3LDEyLjU1NDc5MzUgQzIxLjgwNTU1NzMsMTIuOTI0NjU3NSAyMiwxMy4zNzM3NzI2IDIyLDEzLjkwMjE0OTEgQzIyLDE0LjQzMDUyNTUgMjEuODA1NTU3MywxNC44Nzk2NDA2IDIxLjQxNjY2NjcsMTUuMjQ5NTA0NiBDMjEuMDI3Nzc2LDE1LjYxOTM2ODcgMjAuNTU1NTU3MywxNS44MDQyOTgxIDIwLDE1LjgwNDI5ODEgWiIgaWQ9IkNvbWJpbmVkLVNoYXBlIiBmaWxsPSIjRkZGRkZGIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyMC4wMDAwMDAsIDIwLjAwMDAwMCkgc2NhbGUoMSwgLTEpIHRyYW5zbGF0ZSgtMjAuMDAwMDAwLCAtMjAuMDAwMDAwKSAiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8L2c+CiAgICAgICAgICAgICAgICA8L2c+CiAgICAgICAgICAgIDwvZz4KICAgICAgICA8L2c+CiAgICA8L2c+Cjwvc3ZnPg==" alt="" class="el-message__img">
    <div class="el-message__group">
      <p id="alertmessage1"></p>
    </div>
  </div>
  <div class="el-message el-message2" style="z-index: 2000;display: none"><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjQwcHgiIGhlaWdodD0iNDBweCIgdmlld0JveD0iMCAwIDQwIDQwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPCEtLSBHZW5lcmF0b3I6IFNrZXRjaCAzOS4xICgzMTcyMCkgLSBodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2ggLS0+CiAgICA8dGl0bGU+aWNvbl9zdWNjZXNzPC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGRlZnM+PC9kZWZzPgogICAgPGcgaWQ9IkVsZW1lbnQtZ3VpZGVsaW5lLXYwLjIuNCIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICAgICAgPGcgaWQ9Ik1lc3NhZ2UiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC02MC4wMDAwMDAsIC0yMTIuMDAwMDAwKSI+CiAgICAgICAgICAgIDxnIGlkPSLluKblgL7lkJFf5L+h5oGvIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg2MC4wMDAwMDAsIDIxMi4wMDAwMDApIj4KICAgICAgICAgICAgICAgIDxnIGlkPSJSZWN0YW5nbGUtMiI+CiAgICAgICAgICAgICAgICAgICAgPGcgaWQ9Imljb25fc3VjY2VzcyI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxyZWN0IGlkPSJSZWN0YW5nbGUtMiIgZmlsbD0iIzEzQ0U2NiIgeD0iMCIgeT0iMCIgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIj48L3JlY3Q+CiAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0yNy44MjU1ODE0LDE3LjE0ODQzNTcgTDE5LjAxNzQ0LDI1LjgyODEyMTMgQzE4LjkwMTE2MDksMjUuOTQyNzA4MyAxOC43NjU1MDMzLDI2IDE4LjYxMDQ2NywyNiBDMTguNDU1NDI3LDI2IDE4LjMxOTc2OTMsMjUuOTQyNzA4MyAxOC4yMDM0ODY1LDI1LjgyODEyMTMgTDE4LjAyOTA3MTYsMjUuNjU2MjUgTDEzLjE3NDQxODYsMjAuODQzNzUgQzEzLjA1ODEzOTUsMjAuNzI5MTYzIDEzLDIwLjU5NTQ4MzcgMTMsMjAuNDQyNzA0NyBDMTMsMjAuMjg5OTI5MyAxMy4wNTgxMzk1LDIwLjE1NjI1IDEzLjE3NDQxODYsMjAuMDQxNjY2NyBMMTQuMzY2Mjc3MiwxOC44NjcxODU3IEMxNC40ODI1NiwxOC43NTI2MDIzIDE0LjYxODIxNzcsMTguNjk1MzEwNyAxNC43NzMyNTc3LDE4LjY5NTMxMDcgQzE0LjkyODI5NCwxOC42OTUzMTA3IDE1LjA2Mzk1MTYsMTguNzUyNjAyMyAxNS4xODAyMzA3LDE4Ljg2NzE4NTcgTDE4LjYxMDQ2NywyMi4yNzYwMzggTDI1LjgxOTc2OTMsMTUuMTcxODcxMyBDMjUuOTM2MDQ4NCwxNS4wNTcyODggMjYuMDcxNzA2LDE1IDI2LjIyNjc0MjMsMTUgQzI2LjM4MTc4MjMsMTUgMjYuNTE3NDQsMTUuMDU3Mjg4IDI2LjYzMzcyMjgsMTUuMTcxODcxMyBMMjcuODI1NTgxNCwxNi4zNDYzNTIzIEMyNy45NDE4NjA1LDE2LjQ2MDkzNTcgMjgsMTYuNTk0NjE1IDI4LDE2Ljc0NzM5NCBDMjgsMTYuOTAwMTczIDI3Ljk0MTg2MDUsMTcuMDMzODUyMyAyNy44MjU1ODE0LDE3LjE0ODQzNTcgTDI3LjgyNTU4MTQsMTcuMTQ4NDM1NyBaIiBpZD0iUGF0aCIgZmlsbD0iI0ZGRkZGRiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgPC9nPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+" alt="" class="el-message__img">
    <div class="el-message__group">
      <p id="alertmessage2"></p>
    </div>
  </div>
</body>
<script src="jquery.js"></script>
<script type="text/javascript">
  $(function(){
    var headersJson = {
        "X-Doumi-Agent": "weixinqy"
      }
    var param = '?dmclient=pcweb&X-Doumi-Agent=weixinqy'
    var u = navigator.userAgent
    var isiOS = !!u.match(/\(i[^]+( U)? CPU.+Mac OS X/)
    if (isiOS) {
      $('.code_input').css({ 'font-size': '16px', 'width': '50px', height: '50px' })
    }
    //var host = '//saas-test.doumi.com'
//      var host = '//saas-sim.doumi.com'
    var host  = '//work.doumi.com'
   
    $('.code_input').on('input', function() {
      methods.changCode(this.value, this, $(this).index())
    })
    $('#confirmCode').on('click', function() {
      methods.confirmCode()
    });
    $('.code_input').on('keydown', function() {
      methods.keyupfn(this, $(this).index(), event.which)
    });
    var methods = {
      init:function(){
        this.team_id = this.GetQueryString('team_id')
        this.confirm_id = this.GetQueryString('confirm_id')
        this.project_id = this.GetQueryString('project_id')
        $('.customer_confirm').height(window.innerHeight)
        $('.mask_main').height(406)
        var vm = this
        $.ajax({
            url:host + '/sea/api/1.0/client/v1/confirmmail/feedback'+param,
            type:'POST',
            headers:headersJson,
            data:{
                team_id: vm.team_id,
                project_id:vm.project_id,
                confirm_id:vm.confirm_id,
                confirm_flag:3,
                remark:'',
                code:''
            },
            timeout:10000,
            success:function(obj){
              if(obj.errno== 0){
                if(obj.data.row.status_no == 0){
                  $('#showmain1').css('display','block')
                  $('#showmain2').css('display','none')
                }else{
                  $('#showmain1').css('display','none')
                  $('#showmain2').css('display','block')
                }
                if(obj.data.row.status_no == 1){
                  $('#success_info').text('确认成功')
                }else if(obj.data.row.status_no == 2){
                  $('#success_info').text('问题已反馈')
                }
              }else{
              }
            },
            error: function(xhr, status){
              methods.alertMessage('error','网络连接失败，请检查网络')
            },
            noNetwork: function(){
              methods.alertMessage('error','网络连接失败，请检查网络')
            }
        })
        setTimeout(function() {
          $('.code_input').first().focus()
        }, 10)
      },
      GetQueryString: function(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)")
        var r = ('?' + window.location.href.split('?')[1]).substr(1).match(reg)
        if (r != null) return unescape(r[2])
        return null
      },
      changCode: function(val, target, index) {
        var newVal = val.replace(/\D/g, '')
        target.value = newVal
        $('.mask_main').height(406)
        $('#showerror').css('display', 'none').html('')
        this.inputIndex = index
        if (newVal && index != 3) {
          if ($('.code_input').eq(index + 1).val().replace(/\D/g, '') == ''){
            $('.code_input').eq(index + 1).focus()

          }
        }
        var inpDom = $('.code_input');
        var ifSubmit = true;
        inpDom.map(function(index,val){
          var inpval = val.value;
          if(inpval.replace(/\D/g, '') == '') ifSubmit = false;
        })
        if(ifSubmit)this.confirmCode();
      },
      confirmCode: function() {
        var inpDom = $('.code_input'),
          code = inpDom.eq(0).val() + inpDom.eq(1).val() + inpDom.eq(2).val() + inpDom.eq(3).val()
        if (code.length < 4) {
          $('.mask_main').height(456)
          $('#showerror').css('display', 'block').html('<i class="error_ico"></i>验证码错误')
          return
        }
        var vm  = this;
        $.ajax({
            url:host + '/sea/api/1.0/client/v1/confirmmail/feedback'+param,
            type:'POST',
            headers:headersJson,
            data:{
                team_id: vm.team_id,
                project_id:vm.project_id,
                confirm_id:vm.confirm_id,
                confirm_flag:1,
                remark:'',
                code:code
            },
            timeout:10000,
            success:function(obj){
              if (obj.errno == 0) {
                $('#showerror').css('display', 'none')
                $('#showmain1').css('display', 'none')
                $('#showmain2').css('display', 'block')
                $('.mask_main').height(406)
                $('#success_info').text('确认成功')
              } else {
                $('.mask_main').height(456)
                $('#showerror').css('display', 'block').html('<i class="error_ico"></i>' + obj.errmsg)
              }
            },
            error: function(xhr, status){
              methods.alertMessage('error','网络连接失败，请检查网络')
            },
            noNetwork: function(){
              methods.alertMessage('error','网络连接失败，请检查网络')
            }
        })
      },
      keyupfn: function(target, index, keycode) {
        var val = target.value
        this.inputIndex = index
        if (keycode === 37) {
          if (index > 0) {
            $('.code_input').eq(index - 1).focus()
          }
        } else if (keycode === 39) {
          if (index < 3) {
            $('.code_input').eq(index + 1).focus()
          }
        } else if (keycode === 8) {
          if (index > 0 && val == '') {
            $('.code_input').eq(index - 1).focus()
          }
        }
      },
      alertMessage: function(type, text) {
        if (type == 'success') {
          $('.el-message2').css('display', 'block')
          $('#alertmessage2').text(text)
          setTimeout(function() {
            $('.el-message2').css('display', 'none')
          }, 2000)
        } else {
          $('.el-message1').css('display', 'block')
          $('#alertmessage1').text(text)
          setTimeout(function() {
            $('.el-message1').css('display', 'none')
          }, 2000)
        }
      }
    }
    document.title = '客户验证码确认-斗米工作助手'
    methods.init()
  })
</script>
</html>
