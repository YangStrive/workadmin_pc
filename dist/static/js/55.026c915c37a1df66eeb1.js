webpackJsonp([55],{107:function(e,t,r){var a=r(2)(r(979),r(1528),function(e){r(1307),r(1308)},"data-v-5cac9b0a",null);e.exports=a.exports},1164:function(e,t,r){(e.exports=r(54)(!1)).push([e.i,'.projectset .project_main .el-form-item__content{width:360px}.projectset .project_main .el-radio__label{padding-left:10px}.projectset .project_main .el-form-item{margin-bottom:30px}.projectset .project_main .el-form-item .el-form-item__label{text-align:left;text-indent:23px}.projectset .project_main .el-form-item.is-required .el-form-item__label{position:relative}.projectset .project_main .el-form-item.is-required .el-form-item__label:before{content:"";display:block;width:7px;height:7px;background:url('+r(205)+") no-repeat 0;color:#fa0;position:absolute;left:0;top:14px}.dbl_type.hide{display:none}.dbl_type .el-select-dropdown__list{padding:0}.dbl_type .el-select-dropdown__item.hover,.dbl_type .el-select-dropdown__item.selected{background-color:#fff}.dbl_type .el-select-dropdown__item{height:62px;padding:12px;width:300px}.dbl_type .el-select-dropdown__item .p1{font-size:14px;color:#1f2d3d;line-height:20px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.dbl_type .el-select-dropdown__item .p2{font-size:13px;color:#99a9bf;line-height:18px}.dbl_type .el-select-dropdown__empty{padding:24px 0}",""])},1165:function(e,t,r){(e.exports=r(54)(!1)).push([e.i,".projectset[data-v-5cac9b0a]{padding:0 20px}.projectset .header-title[data-v-5cac9b0a]{padding:16px 0;overflow:hidden;border-bottom:1px solid #e0e6ed}.projectset .header-title h2[data-v-5cac9b0a]{font-size:16px;font-weight:700;text-align:left;color:#475568;line-height:1.4}.projectset .project_main[data-v-5cac9b0a]{padding-top:30px}",""])},1307:function(e,t,r){var a=r(1164);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);r(55)("5400c261",a,!0)},1308:function(e,t,r){var a=r(1165);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);r(55)("5f6c53a7",a,!0)},1528:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"projectset"},[e._m(0),e._v(" "),r("div",{staticClass:"project_main"},[r("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"117px"}},[r("el-form-item",{attrs:{label:"项目名称",prop:"name"}},[r("el-input",{staticStyle:{width:"360px"},attrs:{placeholder:"请输入"},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"开始日期",prop:"start_date"}},[r("el-date-picker",{staticStyle:{width:"100%"},attrs:{disabled:"",type:"date",placeholder:"选择日期",editable:!1,"picker-options":e.startPickerOptions},model:{value:e.ruleForm.start_date,callback:function(t){e.$set(e.ruleForm,"start_date",t)},expression:"ruleForm.start_date"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"结束日期",prop:"end_date"}},[r("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择日期",editable:!1,"picker-options":e.endPickerOptions},model:{value:e.ruleForm.end_date,callback:function(t){e.$set(e.ruleForm,"end_date",t)},expression:"ruleForm.end_date"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"项目归属",prop:"teamAscription"}},[r("el-select",{staticClass:"mystatus",staticStyle:{width:"100%"},attrs:{disabled:""},model:{value:e.ruleForm.teamAscription,callback:function(t){e.$set(e.ruleForm,"teamAscription",t)},expression:"ruleForm.teamAscription"}},[e._l(e.ruleForm.teamArr,function(e){return[r("el-option",{key:e.team_id,attrs:{label:e.team_name,value:e.team_id}})]})],2)],1),e._v(" "),r("el-form-item",{attrs:{label:"城市选择",prop:"city_id"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"请选择"},model:{value:e.ruleForm.city_id,callback:function(t){e.$set(e.ruleForm,"city_id",t)},expression:"ruleForm.city_id"}},[e._l(e.ruleForm.addressArr,function(e){return[r("el-option",{key:e.city_id,attrs:{label:e.short_name,value:e.city_id}})]})],2)],1),e._v(" "),r("el-form-item",{attrs:{label:"项目类型",prop:"type"}},[r("el-select",{staticClass:"mystatus",staticStyle:{width:"100%"},attrs:{placeholder:"请选择项目类型",disabled:""},model:{value:e.ruleForm.type,callback:function(t){e.$set(e.ruleForm,"type",t)},expression:"ruleForm.type"}},[e._l(e.ruleForm.typeArr,function(e){return[r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})]})],2)],1),e._v(" "),r("el-form-item",{staticStyle:{"margin-bottom":"30px"},attrs:{label:"合作企业",prop:"relate_team_id"}},[r("el-select",{staticClass:"mystatus",staticStyle:{width:"100%"},attrs:{"popper-class":e.showResult?"dbl_type":"dbl_type hide",clearable:"",filterable:"",remote:"","remote-method":e.inputFn,placeholder:"通过企业负责人手机号搜索企业","no-data-text":e.noDataText,loading:!e.searchEnd,disabled:0==e.ruleForm.relate_team_can_edit},on:{change:e.changeFn},model:{value:e.ruleForm.relate_team_id,callback:function(t){e.$set(e.ruleForm,"relate_team_id",t)},expression:"ruleForm.relate_team_id"}},[e._l(e.ruleForm.relate_team_arr,function(t){return[r("el-option",{key:t.team_id,attrs:{label:t.team_name,value:t.team_id}},[r("p",{staticClass:"p1"},[e._v(e._s(t.team_name))]),e._v(" "),r("p",{staticClass:"p2"},[e._v("负责人："+e._s(t.name)+"（"+e._s(t.mobile)+"）")])])]})],2)],1),e._v(" "),r("el-form-item",{staticStyle:{"margin-bottom":"67px"},attrs:{label:"",prop:""}},[r("el-button",{attrs:{type:"primary"},on:{click:e.validateProjectSet}},[e._v("保 存")])],1)],1)],1)])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"header-title"},[t("h2",[this._v("项目设置")])])}]}},205:function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxzdmcgd2lkdGg9IjdweCIgaGVpZ2h0PSI3cHgiIHZpZXdCb3g9IjAgMCA3IDciIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+DQogICAgPCEtLSBHZW5lcmF0b3I6IFNrZXRjaCA0NiAoNDQ0MjMpIC0gaHR0cDovL3d3dy5ib2hlbWlhbmNvZGluZy5jb20vc2tldGNoIC0tPg0KICAgIDx0aXRsZT7mmJ/moIc8L3RpdGxlPg0KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPg0KICAgIDxkZWZzPjwvZGVmcz4NCiAgICA8ZyBpZD0iMS4xX+S6uuWRmOeuoeeQhiIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+DQogICAgICAgIDxnIGlkPSJBcnRib2FyZCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIwNS4wMDAwMDAsIC0xOTguMDAwMDAwKSIgZmlsbD0iI0ZGQUEwMCI+DQogICAgICAgICAgICA8cGF0aCBkPSJNMjA3LjQ2NDA0NywyMDAuMjc4NjUxIEwyMDcuNDY0MDQ3LDE5OS4wNzE5ODYgQzIwNy40NjQwNDcsMTk4LjQ3OTk0NCAyMDcuOTIzODk0LDE5OCAyMDguNTAwMDU0LDE5OCBDMjA5LjA3MjIyNSwxOTggMjA5LjUzNjA2MSwxOTguNDc1NzIgMjA5LjUzNjA2MSwxOTkuMDcxOTg2IEwyMDkuNTM2MDYxLDIwMC4yNzg2NTEgTDIxMC42NDQwOTksMTk5LjkwNTc3MSBDMjExLjE4Nzc0OSwxOTkuNzIyODIgMjExLjc3MDU2NSwyMDAuMDI3NDY4IDIxMS45NDg2MDksMjAwLjU5NDk5NyBDMjEyLjEyNTQxOSwyMDEuMTU4NTk3IDIxMS44MzE5MTYsMjAxLjc2MjQ5IDIxMS4yODQzODYsMjAxLjk0Njc0NiBMMjEwLjE3NjM0OSwyMDIuMzE5NjI2IEwyMTAuODYxMTU0LDIwMy4yOTU4MzkgQzIxMS4xOTcxNDgsMjAzLjc3NDgxMSAyMTEuMDk3NTAxLDIwNC40NDMwMzggMjEwLjYzMTM3OCwyMDQuNzkzNzkgQzIxMC4xNjg0ODIsMjA1LjE0MjExNCAyMDkuNTIzMjUxLDIwNS4wMzk2MjEgMjA5LjE4NDg1OSwyMDQuNTU3MjMxIEwyMDguNTAwMDU0LDIwMy41ODEwMTggTDIwNy44MTUyNDksMjA0LjU1NzIzMSBDMjA3LjQ3OTI1NSwyMDUuMDM2MjAzIDIwNi44MzQ4NTMsMjA1LjE0NDU0MiAyMDYuMzY4NzMsMjA0Ljc5Mzc5IEMyMDUuOTA1ODM0LDIwNC40NDU0NjYgMjA1LjgwMDU2MywyMDMuNzc4MjI4IDIwNi4xMzg5NTQsMjAzLjI5NTgzOSBMMjA2LjgyMzc1OSwyMDIuMzE5NjI2IEwyMDUuNzE1NzIyLDIwMS45NDY3NDYgQzIwNS4xNzIwNzEsMjAxLjc2Mzc5NSAyMDQuODczNDU2LDIwMS4xNjI1MjYgMjA1LjA1MTUsMjAwLjU5NDk5NyBDMjA1LjIyODMxLDIwMC4wMzEzOTcgMjA1LjgwODQ4LDE5OS43MjE1MTUgMjA2LjM1NjAwOSwxOTkuOTA1NzcxIEwyMDcuNDY0MDQ3LDIwMC4yNzg2NTEgTDIwNy40NjQwNDcsMjAwLjI3ODY1MSBaIiBpZD0iUmVjdGFuZ2xlLTEyMCI+PC9wYXRoPg0KICAgICAgICA8L2c+DQogICAgPC9nPg0KPC9zdmc+"},979:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(6),o=(r.n(a),r(5));t.default={name:"ProjectSet",data:function(){var e=this;return{team_id:0,project_id:0,ruleForm:{name:"",start_date:o.m(new Date),end_date:"",teamAscription:"",teamArr:[],city_name:"",city_id:"",addressArr:[],type:"",typeArr:[],relate_team_id:"",relate_team_arr:[],relate_team_can_edit:1},rules:{name:[{validator:function(e,t,r){t?t.length>20?r(new Error("项目名称不能超过20字")):r():r(new Error("请输入项目名称"))},required:!0,trigger:"blur"}],start_date:[{validator:function(e,t,r){if(!t)return r(new Error("请选择开始日期"));r()},required:!0,trigger:"change"}],end_date:[{validator:function(t,r,a){if(r){var i=o.p(e.ruleForm.start_date,r),n=new Date,l=n.getMonth()+1,s=n.getDate();l>=1&&l<=9&&(l="0"+l),s>=0&&s<=9&&(s="0"+s);var c=n.getFullYear()+"-"+l+"-"+s,d=o.q(c,i.e)}return r?r<e.ruleForm.start_date?a(new Error("结束时间不能小于开始时间")):d>366?a(new Error("开始时间和结束时间不能超过一年")):void a():a(new Error("请选择结束日期"))},required:!0,trigger:"change"}],teamAscription:[{validator:function(e,t,r){if(!t)return r(new Error("请选择项目归属"));r()},required:!0,trigger:"change"}],city_id:[{validator:function(e,t,r){if(!t)return r(new Error("请选择项目城市"));r()},required:!0,trigger:"change"}],type:[{validator:function(e,t,r){if(!t)return r(new Error("请选择项目类型"));r()},required:!0,trigger:"change"}],relate_team_id:[{validator:function(t,r,a){if(e.team_id==r)return a(new Error("不能选择当前所在企业"));a()}}]},startPickerOptions:{disabledDate:function(e){return e.getTime()<Date.now()-864e5}},endPickerOptions:{disabledDate:function(e){return e.getTime()<Date.now()-864e5}},searchEnd:!0,showResult:!1,noDataText:"您查找的企业不存在"}},methods:{init:function(){this.team_id=o.a("projectStorageInfo").team_id,this.project_id=o.a("projectStorageInfo").project_id,this.getProjectInfo(),this.getAddressData()},getProjectInfo:function(){var e=this;this.ruleForm.relate_team_id="",o.b({url:"/project/info/get",type:"GET",data:{team_id:this.team_id,project_id:this.project_id},success:function(t){console.log("获取项目设置"),console.log(t),t&&0==t.errno&&(e.ruleForm.name=t.data.name,e.ruleForm.start_date=new Date(o.r(t.data.start_date)),e.ruleForm.end_date=new Date(o.r(t.data.end_date)),e.ruleForm.teamAscription=t.data.team_name,e.ruleForm.city_name=t.data.city_name,e.ruleForm.city_id=t.data.city_id,e.ruleForm.type=t.data.project_name,e.ruleForm.relate_team_can_edit=t.data.relate_team_can_edit,0!=t.data.relate_team_id&&(e.ruleForm.relate_team_arr=[{team_id:t.data.relate_team_id,team_name:t.data.relate_team_name,mobile:"",name:""}],setTimeout(function(){e.ruleForm.relate_team_id=t.data.relate_team_id},0)))},error:function(e,t){},noNetwork:function(){e.$message({showClose:!0,message:"网络连接失败，请检查网络",type:"warning"})}})},getUserTeam:function(){var e=this;o.b({url:"/team/list/simple",type:"GET",data:{team_id:0,project_id:0},timeout:1e4,success:function(t){console.log("获取项目归属列表"),console.log(t),t&&0==t.errno&&(e.ruleForm.teamArr=t.data)},error:function(e,t){},noNetwork:function(){e.$message({showClose:!0,message:"网络连接失败，请检查网络",type:"warning"})}})},getAddressData:function(){var e=this;o.b({url:"/common/city/all",type:"GET",data:{},timeout:1e4,success:function(t){t&&0==t.errno&&(e.ruleForm.addressArr=t.data.sort(function(e,t){return e.pinyin.localeCompare(t.pinyin,"zh-Hans-CN",{sensitivity:"accent"})}))},error:function(e,t){},noNetwork:function(){e.$message({showClose:!0,message:"网络连接失败，请检查网络",type:"warning"})}})},getProjectType:function(){var e=this;o.b({url:"/project/type/get",type:"GET",data:{team_id:0},timeout:1e4,success:function(t){t&&0==t.errno&&(e.ruleForm.typeArr=t.data)},error:function(t,r){e.loading=!1},noNetwork:function(){e.loading=!1,e.$message({showClose:!0,message:"网络连接失败，请检查网络",type:"warning"})}})},inputFn:function(e){var t=this;this.showResult=!1,/^1[345678]\d{9}$/.test(e)?(this.showResult=!0,this.searchEnd=!1,o.b({url:"/team/info/search",type:"GET",data:{team_id:this.team_id,mobile:e},timeout:1e4,success:function(e){console.log("手机号查询企业"),console.log(e),t.searchEnd=!0,0==e.errno?t.ruleForm.relate_team_arr=[e.data]:12017==e.errno&&(t.ruleForm.relate_team_arr=[],t.noDataText="您查找的企业不存在")},error:function(e,r){t.searchEnd=!0},noNetwork:function(){t.searchEnd=!0,t.$message({showClose:!0,message:"网络连接失败，请检查网络",type:"warning"})}})):(this.ruleForm.relate_team_arr=[],e.length>=11&&(this.showResult=!0,this.noDataText="请输入正确的手机号"))},changeFn:function(){this.$refs.ruleForm.validateField("relate_team_id"),console.log(this.ruleForm)},validateProjectSet:function(){var e=this;this.$refs.ruleForm.validate(function(t){if(!t)return console.log("error submit!!"),!1;e.saveProjectSetFn()})},saveProjectSetFn:function(){var e=this,t={team_id:this.team_id,project_id:this.project_id,name:this.ruleForm.name,start_date:o.e(new Date(this.ruleForm.start_date).getTime(),"yyyy-MM-dd"),end_date:o.e(new Date(this.ruleForm.end_date).getTime(),"yyyy-MM-dd"),city_id:this.ruleForm.city_id};this.ruleForm.addressArr.forEach(function(r){r.city_id==e.ruleForm.city_id&&(t.city_name=e.ruleForm.city_name=r.short_name)}),1==this.ruleForm.relate_team_can_edit&&(t.relate_team_id=this.ruleForm.relate_team_id),o.b({url:"/project/info/update",type:"POST",data:t,timeout:1e4,success:function(t){if(t&&0==t.errno){var r=o.a("projectStorageInfo");r.name=e.ruleForm.name,o.c("projectStorageInfo",r),e.$message({showClose:!0,message:"保存成功",type:"success"}),setTimeout(function(){window.location.reload()},1e3)}else e.$message({showClose:!0,message:t.errmsg,type:"warning"})},error:function(t,r){e.loading=!1},noNetwork:function(){e.loading=!1,e.$message({showClose:!0,message:"网络连接失败，请检查网络",type:"warning"})}})}},mounted:function(){this.init()},watch:{$route:function(e,t){this.init()}}}}});